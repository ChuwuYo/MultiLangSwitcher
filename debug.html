<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="color-scheme" content="light dark">
  <title></title>
  <!-- 字体预加载 -->
  <link rel="preload" href="fonts/MapleMonoNL-Regular.woff2" as="font" type="font/woff2" crossorigin>
  <link href="bootstrap.min.css" rel="stylesheet">
  <link href="fonts/MapleMonoNL-Regular.woff2" rel="stylesheet">
  <link href="toggle.css" rel="stylesheet">
  <style>
    body {
      padding: 20px;
    }

    .debug-section {
      position: relative;
      margin-bottom: 20px;
      padding: 15px;
      border-radius: 5px;
      background-color: #f8f9fa;
    }

    /* 确保所有卡片间距一致 */
    .col-md-6 .debug-section {
      margin-bottom: 20px;
    }

    .debug-result {
      margin-top: 10px;
      padding: 15px;
      border-radius: 5px;
      background-color: #fff;
      border: 1px solid #dee2e6;
      min-height: 60px;
      height: auto !important;
      max-height: 400px;
      overflow-y: auto;
      word-break: break-word;
      white-space: normal;
      font-size: 0.9em;
      line-height: 1.5;
      box-sizing: border-box;
      display: block;
      width: 100%;
    }

    .success {
      color: green;
      font-weight: bold;
    }

    .error {
      color: rgb(240, 101, 101);
      font-weight: bold;
    }

    /* 日志不同类型的颜色 */
    .log-info {
      color: rgb(165, 165, 250);
    }

    .log-warning {
      color: orange;
    }

    .log-error {
      color: rgb(248, 115, 115);
    }

    .log-success {
      color: green;
    }

    @font-face {
      font-family: 'MapleMonoNL';
      src: url('fonts/MapleMonoNL-Regular.woff2') format('woff2');
    }

    body {
      font-family: 'MapleMonoNL', sans-serif;
    }

    /* 匹配规则详情的样式 */
    .matched-rule-detail {
      margin-left: 15px;
      border-left: 2px solid #007bff;
      padding-left: 10px;
      margin-bottom: 5px;
    }

    .reset-btn-corner {
      position: absolute;
      top: 10px;
      right: 10px;
    }

    /* 缓存管理样式 */
    .cache-stats-container {
      background-color: #fff;
      border: 1px solid #dee2e6;
      border-radius: 5px;
      padding: 10px;
      font-size: 0.9em;
    }

    .cache-stat-item {
      padding: 5px 0;
    }

    .cache-size {
      font-weight: bold;
      color: #0d6efd;
    }

    .cache-hit-rate {
      font-size: 0.8em;
      color: #6c757d;
    }

    .preload-status {
      font-weight: bold;
    }

    .preload-status.loaded {
      color: #198754;
    }

    .preload-status.not-loaded {
      color: #dc3545;
    }

    .preload-status.loading {
      color: #fd7e14;
    }

    /* 暗色主题下的缓存管理样式 */
    html[data-bs-theme="dark"] .cache-stats-container {
      background-color: #2c3034;
      border-color: #495057;
      color: #f8f9fa;
    }

    html[data-bs-theme="dark"] .cache-size {
      color: #86b7fe;
    }

    html[data-bs-theme="dark"] .cache-hit-rate {
      color: #adb5bd;
    }

    /* 缓存操作结果显示框样式 */
    #cacheOperationResult {
      margin-top: 10px;
      padding: 8px 10px;
      /* 减少上下内边距 */
      border-radius: 5px;
      background-color: #fff;
      border: 1px solid #dee2e6;
      min-height: 2.2em;
      /* 最小高度约一行 */
      max-height: 400px;
      /* 增加最大高度限制 */
      overflow-y: auto;
      /* 内容超出时显示滚动条 */
      word-break: break-word;
      white-space: normal;
      /* 允许正常换行 */
      font-size: 0.9em;
      line-height: 1.4;
    }

    /* 暗色主题下的缓存操作结果样式 */
    html[data-bs-theme="dark"] #cacheOperationResult {
      background-color: #2c3034;
      border-color: #495057;
      color: #f8f9fa;
    }
  </style>
</head>

<body>
  <button id="themeToggleBtn" class="toggle" title="Toggle Theme"></button>

  <div class="container">
    <h2 id="pageHeading"></h2>
    <p class="lead" id="pageSubtitle"></p>

    <div class="alert alert-info">
      <strong id="tipLabel"></strong> <span id="tipText"></span>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="debug-section">
          <h4 id="currentRulesTitle"></h4>
          <p class="text-muted" id="currentRulesDesc"></p>
          <button id="showRulesBtn" class="btn btn-primary"></button>
          <div id="rulesResult" class="debug-result"></div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="debug-section">
          <h4 id="headerTestTitle"></h4>
          <p class="text-muted" id="headerTestDesc"></p>
          <div class="mb-3">
            <label for="testLanguage" class="form-label" id="testLanguageLabel"></label>
            <select class="form-select" id="testLanguage">
              <!-- 语言选项将由JavaScript动态生成 -->
            </select>
          </div>
          <button id="testHeaderBtn" class="btn btn-success"></button>
          <div id="headerTestResult" class="debug-result"></div>
        </div>
      </div>

      <!-- 自定义语言设置 -->
      <div class="col-md-6">
        <div class="debug-section">
          <button id="resetCustomLangBtn" class="toggle reset-btn-corner"><img src="images/reset.svg" id="resetBtnImg"
              width="16" height="16" class="invert-on-dark"></button>
          <h4 id="customLangTitle"></h4>
          <p class="text-muted" id="customLangDesc"></p>
          <div class="mb-3">
            <label for="customLanguageInput" class="form-label" id="customLangInputLabel"></label>
            <input type="text" class="form-control" id="customLanguageInput">
          </div>
          <button id="applyCustomLangBtn" class="btn btn-primary"></button>
          <div id="customLangResult" class="debug-result mt-2"></div>
        </div>
      </div>
      <!-- 自定义语言设置结束 -->

      <!-- Accept-Language 格式说明卡片 -->
      <div class="col-md-6">
        <div class="debug-section">
          <h4 id="formatExplanationTitle"></h4>
          <p class="text-muted" id="formatExplanationDesc"></p>
          <p><strong id="basicFormatTitle"></strong></p>
          <ul id="formatList">
            <li id="languageCodeItem"></li>
            <li id="regionCodeItem"></li>
            <li id="qualityValueItem"></li>
          </ul>
          <p><strong id="examplesTitle"></strong></p>
          <ul id="examplesList">
            <li id="exampleComplex"></li>
          </ul>
          <p class="small text-muted" id="formatNote"></p>
        </div>
      </div>
      <!-- Accept-Language 格式说明卡片结束 -->

      <!-- 域名匹配缓存管理卡片 -->
      <div class="col-md-6">
        <div class="debug-section">
          <h4 id="cacheManagementTitle"></h4>
          <p class="text-muted" id="cacheManagementDesc"></p>

          <!-- 缓存统计显示 -->
          <div class="mb-3">
            <h6 id="cacheStatsTitle"></h6>
            <div id="cacheStatsDisplay" class="cache-stats-container">
              <div class="row g-2">
                <div class="col-6">
                  <div class="cache-stat-item">
                    <small class="text-muted" id="domainCacheLabel"></small>
                    <div class="d-flex align-items-center">
                      <span id="domainCacheSize" class="cache-size">-</span>
                      <span class="cache-hit-rate ms-2" id="domainCacheHitRate">(-)</span>
                    </div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="cache-stat-item">
                    <small class="text-muted" id="parsedCacheLabel"></small>
                    <div class="d-flex align-items-center">
                      <span id="parsedCacheSize" class="cache-size">-</span>
                      <span class="cache-hit-rate ms-2" id="parsedCacheHitRate">(-)</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="mt-2">
                <small class="text-muted" id="preloadStatusLabel"></small>
                <span id="preloadStatus" class="preload-status">-</span>
              </div>
            </div>
          </div>

          <!-- 缓存测试 -->
          <div class="mb-3">
            <label for="testDomainInput" class="form-label" id="testDomainLabel"></label>
            <div class="input-group">
              <input type="text" class="form-control form-control-sm" id="testDomainInput" placeholder="example.com">
              <button id="testDomainBtn" class="btn btn-outline-success btn-sm"></button>
            </div>
          </div>

          <!-- 缓存管理按钮 -->
          <div class="mb-3">
            <div class="d-grid gap-2">
              <div class="row g-2">
                <div class="col-6">
                  <button id="refreshCacheStatsBtn" class="btn btn-info btn-sm w-100"></button>
                </div>
                <div class="col-6">
                  <button id="preloadRulesBtn" class="btn btn-primary btn-sm w-100"></button>
                </div>
              </div>
              <div class="row g-2">
                <div class="col-6">
                  <button id="clearDomainCacheBtn" class="btn btn-warning btn-sm w-100"></button>
                </div>
                <div class="col-6">
                  <button id="clearAllCacheBtn" class="btn btn-danger btn-sm w-100"></button>
                </div>
              </div>
              <button id="resetCacheStatsBtn" class="btn btn-secondary btn-sm w-100"></button>
            </div>
          </div>

          <!-- 缓存操作结果显示 -->
          <div id="cacheOperationResult" class="debug-result"></div>
        </div>
      </div>
      <!-- 域名匹配缓存管理卡片结束 -->

    </div>

    <div class="debug-section mt-4">
      <h4 id="liveLogsTitle"></h4>
      <p class="text-muted" id="liveLogsDesc"></p>
      <div class="mb-3">
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="checkbox" id="filterInfo" value="info" checked>
          <label class="form-check-label" for="filterInfo" id="infoLabel"></label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="checkbox" id="filterWarning" value="warning" checked>
          <label class="form-check-label" for="filterWarning" id="warningLabel"></label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="checkbox" id="filterError" value="error" checked>
          <label class="form-check-label" for="filterError" id="errorLabel"></label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="checkbox" id="filterSuccess" value="success" checked>
          <label class="form-check-label" for="filterSuccess" id="successLabel"></label>
        </div>
      </div>
      <div id="logOutput" class="debug-result"></div>
      <button id="clearLogsBtn" class="btn btn-secondary btn-sm mt-2"></button>
    </div>

    <div class="debug-section mt-4">
      <h4 id="commonFixesTitle"></h4>
      <p class="text-muted" id="commonFixesDesc"></p>
      <div class="list-group">
        <button id="fixPriorityBtn" class="list-group-item list-group-item-action">
          <strong id="fixPriorityTitle"></strong> <span id="fixPriorityDesc"></span>
        </button>
        <button id="clearAllRulesBtn" class="list-group-item list-group-item-action">
          <strong id="clearReapplyTitle"></strong> <span id="clearReapplyDesc"></span>
        </button>
      </div>
      <div id="fixResult" class="debug-result mt-3"></div>
    </div>

    <div class="debug-section mt-4">
      <h4 id="diagnosticsTitle"></h4>
      <p class="text-muted" id="diagnosticsDesc"></p>
      <button id="showDiagnosticsBtn" class="btn btn-info"></button>
      <div id="diagnosticsResult" class="debug-result"></div>
    </div>

    <!-- 自动切换功能控制 -->
    <div class="debug-section mt-4">
      <h4 id="autoSwitchTitle"></h4>
      <p class="text-muted" id="autoSwitchDesc"></p>
      <div class="form-check form-switch mb-3">
        <input class="form-check-input" type="checkbox" id="autoSwitchToggle">
        <label class="form-check-label" for="autoSwitchToggle" id="enableAutoSwitchLabel"></label>
      </div>
      <button id="showDomainRulesBtn" class="btn btn-outline-primary"></button>
      <div id="domainRulesResult" class="debug-result"></div>
    </div>
    <!-- 自动切换功能控制结束 -->
  </div>

  <!-- 按正确顺序加载脚本 -->
  <script src="shared/shared-utils.js"></script>
  <script src="shared/shared-i18n-base.js"></script>
  <script src="shared/shared-language-options.js"></script>
  <script src="shared/shared-actions.js"></script>
  <!-- 预加载翻译文件 -->
  <script src="i18n/debug-en.js"></script>
  <script src="i18n/debug-zh.js"></script>
  <script src="i18n/debug-i18n.js"></script>
  <script src="debug-headers.js"></script>
  <script src="debug-ui.js"></script>
  <script type="module" src="toggle.js"></script>
</body>

</html>